@model WebLeagueManager.Views.Home.RankingsModel
@{
}

<br />
<h2>Clasificaciones</h2>
<section>
    <p>Escoge la competición</p>
    <select id="competition_select">
        @foreach (Competition item in Model.competitions)
        {
            <option value="@item.ID">@item.Name</option>
        }
    </select>
    <table class="table" id="table_ranking">
        <thead>
            <tr>
                <th>Pos</th>
                <th>Equipo</th>
                <th>PJ</th>
                <th>PG</th>
                <th>PE</th>
                <th>PP</th>
                <th>GF</th>
                <th>GC</th>
                <th>DG</th>
                <th>Puntos</th>
            </tr>
        </thead>
        <tbody class="ranking" id="tablebody_rankings">
            @foreach (RankingTeam item in Model.rankingTeams)
            {
                <tr id="@item.team.Id">
                    <td>@item.Pos</td>
                    <td>@item.team.Name</td>
                    <td>@item.gamesPlayed</td>
                    <td>@item.victories</td>
                    <td>@item.draws</td>
                    <td>@item.defeats</td>
                    <td>@item.goals</td>
                    <td>@item.goalsAgainst</td>
                    <td>@(@item.goals - @item.goalsAgainst)</td>
                    <td>@item.points</td>
                </tr>
            }
        </tbody>
    </table>
</section>

<script defer>

    const competitions = @Html.Raw(Model.getRankings());
    const jsonStringCompetitions = JSON.stringify(competitions);
    const jsonObjCompetitions = JSON.parse(jsonStringCompetitions);
    const tableRankig = document.getElementById("table_ranking");
    const tableBodyRanking = document.getElementById("tablebody_rankings");
    const competitionSelect = document.getElementById("competition_select");

    competitionSelect.addEventListener("change", () => {

        const selectedComp = competitionSelect.value;
        const rankingArray = readRankingById(selectedComp, jsonStringCompetitions)

        if(rankingArray.type == "League") {
            drawTable(rankingArray.rankingTeams)
        }
        else {
            console.log("Es copa")
        }
    });

    function readRankingById(competitionId, jsonData) {
        var data = JSON.parse(jsonData)
        for (let i=0; i<data.length ; i++){
            if (data[i].id_competition == competitionId) {
                return data[i];
            }
        }

        return null
    }

    function drawTable(rankingTeams)
    {
        while(tableBodyRanking.firstChild){
            tableBodyRanking.removeChild(tableBodyRanking.firstChild)
        }

        for(let i=0; i<rankingTeams.length; i++)
        {
            const rankingTeamsRow = rankingTeams[i];
            var newRowAux = newRow(rankingTeamsRow)
            tableBodyRanking.appendChild(newRowAux)
        }
    }

    function newRow(rankingTeamsRow) {
        var newRow = document.createElement("tr");
        newRow.id = rankingTeamsRow.team.Id;
        var cell_0 = document.createElement("td");
        cell_0.appendChild(document.createTextNode(rankingTeamsRow.Pos));
        var cell_1 = document.createElement("td");
        cell_1.appendChild(document.createTextNode(rankingTeamsRow.team.Name));
        var cell_2 = document.createElement("td");
        cell_2.appendChild(document.createTextNode(rankingTeamsRow.gamesPlayed));
        var cell_3 = document.createElement("td");
        cell_3.appendChild(document.createTextNode(rankingTeamsRow.victories));
        var cell_4 = document.createElement("td");
        cell_4.appendChild(document.createTextNode(rankingTeamsRow.draws));
        var cell_5 = document.createElement("td");
        cell_5.appendChild(document.createTextNode(rankingTeamsRow.defeats));
        var cell_6 = document.createElement("td");
        cell_6.appendChild(document.createTextNode(rankingTeamsRow.goals));
        var cell_7 = document.createElement("td");
        cell_7.appendChild(document.createTextNode(rankingTeamsRow.goalsAgainst));
        var cell_8 = document.createElement("td");
        cell_8.appendChild(document.createTextNode((rankingTeamsRow.goals - rankingTeamsRow.goalsAgainst)));
        var cell_9 = document.createElement("td");
        cell_9.appendChild(document.createTextNode(rankingTeamsRow.points));
        newRow.appendChild(cell_0)
        newRow.appendChild(cell_1)
        newRow.appendChild(cell_2)
        newRow.appendChild(cell_3)
        newRow.appendChild(cell_4)
        newRow.appendChild(cell_5)
        newRow.appendChild(cell_6)
        newRow.appendChild(cell_7)
        newRow.appendChild(cell_8)
        newRow.appendChild(cell_9)

        return newRow
    }

</script>



<style>
    .ranking tr:hover {
        background-color: rgb(45, 44, 44);
        color: white;
        cursor: pointer;
        transition: .2s;
    }
</style>